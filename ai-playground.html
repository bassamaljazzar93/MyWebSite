<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI Playground - Generate images with AI assistant, create content, and explore AI capabilities">
    <title>AI Playground - Free AI Tools by Bassam Aljazzar</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00d9ff;
            --secondary: #7c3aed;
            --accent: #f59e0b;
            --bg-dark: #0a0e27;
            --bg-darker: #050816;
            --text-light: #e5e7eb;
            --text-dim: #9ca3af;
            --card-bg: rgba(15, 23, 42, 0.8);
            --border: rgba(0, 217, 255, 0.2);
            --error: #ef4444;
            --success: #22c55e;
        }

        body {
            font-family: 'Inter', 'Cairo', sans-serif;
            background: var(--bg-darker);
            color: var(--text-light);
            overflow-x: hidden;
            line-height: 1.6;
        }

        body[dir="rtl"] {
            font-family: 'Cairo', 'Inter', sans-serif;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, #0a0e27 0%, #050816 100%);
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 217, 255, 0.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: moveGrid 20s linear infinite;
        }

        @keyframes moveGrid {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .header {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .lang-switch {
            background: var(--card-bg);
            border: 1px solid var(--border);
            color: var(--text-light);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .lang-switch:hover {
            background: var(--primary);
            color: var(--bg-dark);
            border-color: var(--primary);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            padding: 2rem 0;
        }

        .hero h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .hero p {
            color: var(--text-dim);
            font-size: 1.1rem;
        }

        /* Tabs */
        .tabs-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .tab-btn {
            background: var(--card-bg);
            border: 2px solid var(--border);
            color: var(--text-light);
            padding: 1rem 2rem;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .tab-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 217, 255, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .section {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            backdrop-filter: blur(10px);
        }

        .section h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        /* Chat Section */
        .chat-container {
            height: 400px;
            overflow-y: auto;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .chat-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-message.user {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid var(--primary);
            margin-left: 2rem;
        }

        .chat-message.ai {
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid var(--secondary);
            margin-right: 2rem;
        }

        .chat-message .label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .chat-message.user .label {
            color: var(--primary);
        }

        .chat-message.ai .label {
            color: var(--secondary);
        }

        .chat-input-area {
            display: flex;
            gap: 0.5rem;
        }

        textarea, input[type="text"], select {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 0.75rem;
            color: var(--text-light);
            font-family: inherit;
            font-size: 0.95rem;
            resize: vertical;
        }

        textarea:focus, input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 217, 255, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--card-bg);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: none;
        }

        /* Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .setting-group label {
            color: var(--text-dim);
            font-size: 0.9rem;
        }

        /* Image Gallery */
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .image-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            background: rgba(0, 0, 0, 0.3);
        }

        .image-item:hover {
            border-color: var(--primary);
            transform: scale(1.03);
        }

        .image-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .image-actions {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9), transparent);
            padding: 1rem;
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-item:hover .image-actions {
            opacity: 1;
        }

        .icon-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 217, 255, 0.4);
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-dim);
        }

        .spinner {
            border: 3px solid rgba(0, 217, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--primary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
            animation: slideIn 0.3s ease;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--error);
            color: var(--error);
        }

        .alert-success {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
        }

        .quick-prompts {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .quick-prompt {
            background: rgba(124, 58, 237, 0.2);
            border: 1px solid var(--secondary);
            color: var(--text-light);
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-prompt:hover {
            background: rgba(124, 58, 237, 0.4);
            transform: translateY(-2px);
        }

        footer {
            background: var(--bg-dark);
            border-top: 1px solid var(--border);
            padding: 2rem;
            text-align: center;
            color: var(--text-dim);
            margin-top: 3rem;
        }

        @media (max-width: 1200px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr 1fr;
            }

            .tabs-container {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .hero h1 {
                font-size: 1.8rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .chat-container {
                height: 300px;
            }

            #textChatContainer {
                height: 400px !important;
            }

            .chat-message.user {
                margin-left: 0.5rem;
            }

            .chat-message.ai {
                margin-right: 0.5rem;
            }

            .image-gallery {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }

            .image-item img {
                height: 150px;
            }

            .tab-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <div class="header">
        <div class="header-container">
            <div class="logo" data-en="🤖 AI Playground" data-ar="🤖 ملعب الذكاء الاصطناعي">🤖 AI Playground</div>
            <button class="lang-switch" id="langSwitch" onclick="toggleLanguage()">العربية</button>
        </div>
    </div>

    <div class="container">
        <div class="hero">
            <h1 data-en="AI Playground - Creative Tools" data-ar="ملعب الذكاء الاصطناعي - أدوات إبداعية">AI Playground - Creative Tools</h1>
            <p data-en="Generate stunning images with AI assistant and chat with AI about anything!" data-ar="ولّد صور مذهلة مع مساعد ذكي وتحدث مع الذكاء الاصطناعي عن أي شيء!">
                Generate stunning images with AI assistant and chat with AI about anything!
            </p>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <button class="tab-btn active" onclick="switchTab('images')" data-en="🎨 Image Generator" data-ar="🎨 مولد الصور">🎨 Image Generator</button>
            <button class="tab-btn" onclick="switchTab('text')" data-en="💬 AI Chat" data-ar="💬 محادثة AI">💬 AI Chat</button>
        </div>

        <!-- Tab Content: Image Generator -->
        <div class="tab-content active" id="images">
            <div class="main-grid">
            <!-- Chat Section -->
            <div class="section">
                <h2 data-en="💬 AI Assistant" data-ar="💬 المساعد الذكي">💬 AI Assistant</h2>
                
                <div class="quick-prompts">
                    <button class="quick-prompt" onclick="quickPrompt('help me create a beautiful sunset image')" data-en="🌅 Sunset" data-ar="🌅 غروب">🌅 Sunset</button>
                    <button class="quick-prompt" onclick="quickPrompt('futuristic city with flying cars')" data-en="🏙️ Sci-Fi City" data-ar="🏙️ مدينة خيالية">🏙️ Sci-Fi City</button>
                    <button class="quick-prompt" onclick="quickPrompt('cute anime character')" data-en="👾 Anime" data-ar="👾 أنمي">👾 Anime</button>
                    <button class="quick-prompt" onclick="quickPrompt('professional portrait photo')" data-en="👤 Portrait" data-ar="👤 بورتريه">👤 Portrait</button>
                </div>

                <div class="chat-container" id="chatContainer">
                    <div class="chat-message ai">
                        <div class="label" data-en="🤖 AI Assistant" data-ar="🤖 المساعد الذكي">🤖 AI Assistant</div>
                        <div data-en="Hello! I'm your AI image creation assistant. Tell me what you want to create, and I'll help you craft the perfect prompt, choose the best model, and optimize settings. Each seed number creates unique variations!" data-ar="مرحباً! أنا مساعدك في إنشاء الصور بالذكاء الاصطناعي. أخبرني ماذا تريد أن تصنع، وسأساعدك في صياغة الوصف المثالي، اختيار أفضل موديل، وضبط الإعدادات. كل رقم seed ينشئ variation فريد!">
                            Hello! I'm your AI image creation assistant. Tell me what you want to create, and I'll help you craft the perfect prompt, choose the best model, and optimize settings. Each seed number creates unique variations!
                        </div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <textarea id="chatInput" rows="2" placeholder="Describe your image idea..." data-placeholder-en="Describe your image idea..." data-placeholder-ar="صف فكرة الصورة..."></textarea>
                    <button class="btn" onclick="sendMessage()" id="chatBtn" data-en="Send" data-ar="إرسال">Send</button>
                </div>
            </div>

            <!-- Image Generation Section -->
            <div class="section">
                <h2 data-en="🎨 Image Generator" data-ar="🎨 مولد الصور">🎨 Image Generator</h2>

                <div class="settings-grid">
                    <div class="setting-group">
                        <label data-en="Model" data-ar="الموديل">Model</label>
                        <select id="modelSelect">
                            <option value="flux">Flux (Best Quality)</option>
                            <option value="flux-realism">Flux Realism</option>
                            <option value="flux-anime">Flux Anime</option>
                            <option value="flux-3d">Flux 3D</option>
                            <option value="flux-pro">Flux Pro</option>
                            <option value="turbo">Turbo (Fast)</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label data-en="Size" data-ar="الحجم">Size</label>
                        <select id="sizeSelect">
                            <option value="1024x1024">Square (1024x1024)</option>
                            <option value="1024x768">Landscape (1024x768)</option>
                            <option value="768x1024">Portrait (768x1024)</option>
                            <option value="1280x720">Wide (1280x720)</option>
                            <option value="1920x1080">Full HD (1920x1080)</option>
                        </select>
                    </div>

                    <div class="setting-group">
                        <label data-en="Seed (Variation)" data-ar="البذرة (التنويع)">Seed (Variation)</label>
                        <div style="display: flex; gap: 0.5rem;">
                            <input type="number" id="seedInput" value="42" min="1" max="9999" style="padding: 0.75rem; flex: 1;">
                            <button class="btn btn-secondary" onclick="randomSeed()" style="padding: 0.75rem 1rem;" title="Random seed">🎲</button>
                        </div>
                        <small style="color: var(--text-dim); font-size: 0.8rem;" data-en="Each seed creates different variations" data-ar="كل رقم ينشئ variation مختلف">Each seed creates different variations</small>
                    </div>

                    <div class="setting-group">
                        <label data-en="Enhancement" data-ar="التحسين">Enhancement</label>
                        <select id="enhanceSelect">
                            <option value="true">Enhanced (Better Quality)</option>
                            <option value="false">Normal</option>
                        </select>
                    </div>
                </div>

                <input type="text" id="imagePrompt" placeholder="Image description (or get one from AI chat)..." data-placeholder-en="Image description (or get one from AI chat)..." data-placeholder-ar="وصف الصورة (أو احصل عليه من المحادثة)...">
                
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button class="btn" onclick="generateImage()" style="flex: 1;" data-en="🎨 Generate Image" data-ar="🎨 ولّد صورة">🎨 Generate Image</button>
                    <button class="btn btn-secondary" onclick="clearGallery()" data-en="🗑️ Clear" data-ar="🗑️ مسح">🗑️ Clear</button>
                </div>

                <div style="margin-top: 1rem; padding: 1rem; background: rgba(0, 217, 255, 0.05); border: 1px solid var(--border); border-radius: 10px;">
                    <small style="color: var(--text-dim); display: block; line-height: 1.6;" data-en="💡 Tip: Use the AI chat on the left to get perfect prompts and settings! Or hover over images for quick actions." data-ar="💡 نصيحة: استخدم الشات الذكي على اليسار للحصول على prompts وإعدادات مثالية! أو مرر الفأرة فوق الصور للإجراءات السريعة.">
                        💡 Tip: Use the AI chat on the left to get perfect prompts and settings! Or hover over images for quick actions.
                    </small>
                </div>

                <div id="imageOutput"></div>

                <div class="image-gallery" id="imageGallery"></div>
            </div>
        </div>
        </div>

        <!-- Tab Content: AI Chat -->
        <div class="tab-content" id="text">
            <div class="section">
                <h2 data-en="💬 AI Text Chat" data-ar="💬 محادثة AI النصية">💬 AI Text Chat</h2>
                <p style="color: var(--text-dim); margin-bottom: 1.5rem;" data-en="Chat with AI about anything! Ask questions, get creative ideas, learn new topics." data-ar="تحدث مع الذكاء الاصطناعي عن أي شيء! اسأل أسئلة، احصل على أفكار إبداعية، تعلم مواضيع جديدة.">
                    Chat with AI about anything! Ask questions, get creative ideas, learn new topics.
                </p>

                <div class="chat-container" id="textChatContainer" style="height: 500px;">
                    <div class="chat-message ai">
                        <div class="label" data-en="🤖 AI Assistant" data-ar="🤖 المساعد الذكي">🤖 AI Assistant</div>
                        <div data-en="Hello! I'm a general AI assistant. I can help you with questions, creative writing, explanations, advice, and more. What would you like to talk about?" data-ar="مرحباً! أنا مساعد ذكاء اصطناعي عام. أستطيع مساعدتك في الأسئلة، الكتابة الإبداعية، الشروحات، النصائح، والمزيد. عمّا تريد أن نتحدث؟">
                            Hello! I'm a general AI assistant. I can help you with questions, creative writing, explanations, advice, and more. What would you like to talk about?
                        </div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <textarea id="textChatInput" rows="2" placeholder="Ask me anything..." data-placeholder-en="Ask me anything..." data-placeholder-ar="اسألني أي شيء..."></textarea>
                    <button class="btn" onclick="sendTextChat()" id="textChatBtn" data-en="Send" data-ar="إرسال">Send</button>
                </div>
                
                <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                    <button class="btn btn-secondary" onclick="clearTextChat()" data-en="🗑️ Clear Chat" data-ar="🗑️ مسح المحادثة">🗑️ Clear Chat</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p data-en="AI Playground by Bassam Aljazzar | Powered by Pollinations.AI" data-ar="ملعب الذكاء الاصطناعي من بسام الجزار | بدعم من Pollinations.AI">
            AI Playground by Bassam Aljazzar | Powered by Pollinations.AI
        </p>
        <p style="margin-top: 0.5rem; font-size: 0.9rem;">
            <a href="index.html" style="color: var(--primary); text-decoration: none;" data-en="← Back to Portfolio" data-ar="← العودة للبورتفوليو">← Back to Portfolio</a>
        </p>
    </footer>

    <script>
        let currentLang = 'en';
        let chatHistory = [];
        let textChatHistory = [];
        let lastRequestTime = 0;
        const MIN_REQUEST_INTERVAL = 2000;
        let generatedImages = [];

        const bannedWords = [
            'fuck', 'shit', 'asshole', 'bitch', 'dick', 'pussy', 'cock', 'cunt', 
            'bastard', 'porn', 'sex', 'nude', 'naked', 'kill', 'murder', 'violence',
            'كس', 'زب', 'خرا', 'عرص', 'شرموط', 'قحب', 'منيك', 'نيك', 'عاهرة'
        ];

        function containsInappropriateContent(text) {
            const lowerText = text.toLowerCase();
            return bannedWords.some(word => lowerText.includes(word));
        }

        // Switch Tabs
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ar' : 'en';
            document.documentElement.lang = currentLang;
            document.documentElement.dir = currentLang === 'ar' ? 'rtl' : 'ltr';
            
            updateDataAttributes();
            
            document.getElementById('langSwitch').textContent = currentLang === 'en' ? 'العربية' : 'English';
        }

        function quickPrompt(text) {
            document.getElementById('chatInput').value = text;
            sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            if (containsInappropriateContent(message)) {
                showAlert('error', currentLang === 'ar' ? '❌ المحتوى غير مناسب. الرجاء استخدام لغة محترمة.' : '❌ Inappropriate content. Please use respectful language.');
                return;
            }

            const now = Date.now();
            if (now - lastRequestTime < MIN_REQUEST_INTERVAL) {
                const waitTime = Math.ceil((MIN_REQUEST_INTERVAL - (now - lastRequestTime)) / 1000);
                showAlert('warning', currentLang === 'ar' ? `⏱️ انتظر ${waitTime} ثانية` : `⏱️ Wait ${waitTime}s`);
                return;
            }

            lastRequestTime = now;

            addChatMessage('user', message);
            input.value = '';
            
            const btn = document.getElementById('chatBtn');
            btn.disabled = true;

            const loadingMsg = addChatMessage('ai', currentLang === 'ar' ? '🤖 جاري التفكير...' : '🤖 Thinking...');

            try {
                const systemPrompt = `You are an expert AI image prompt creator. Help users create detailed, effective prompts for AI image generation. 

Guidelines:
- Create detailed, descriptive prompts with artistic style, lighting, composition
- Suggest appropriate settings (model, size, seed) based on the image type
- Be creative and enhance user ideas
- Keep prompts under 200 words
- Focus on visual details: colors, mood, lighting, style, composition
- Avoid inappropriate content

Available Models:
- flux: Best overall quality, versatile
- flux-realism: Photorealistic images
- flux-anime: Anime and manga style
- flux-3d: 3D rendered look
- flux-pro: Professional grade, highest quality
- turbo: Fast generation, good quality

Available Sizes:
- square (1024x1024): Profile pictures, logos
- landscape (1024x768): Wallpapers, banners
- portrait (768x1024): Vertical content
- wide (1280x720): Widescreen
- fullhd (1920x1080): High resolution

Seed Information:
- Each seed number creates a different variation
- Use same seed with same prompt to get similar results
- Change seed to get new variations of the same idea

When user describes an idea, respond with:
1. An optimized prompt (clear and detailed)
2. Recommended model (choose best match)
3. Recommended size
4. Seed tip (suggest keeping current or changing)

Example response format:
"Here's your optimized prompt:
[Detailed prompt here]

Recommended Settings:
- Model: flux-realism
- Size: landscape
- Seed: Keep current for consistency, or change for variations

Ready to generate!"

${currentLang === 'ar' ? 'Respond in Arabic for Arabic messages.' : ''}
${currentLang === 'ar' ? 'اذكر أسماء الموديلات بالإنجليزية كما هي: flux, flux-realism, flux-anime, flux-3d, flux-pro, turbo' : ''}`;

                const response = await fetch('https://text.pollinations.ai/openai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: systemPrompt },
                            ...chatHistory.slice(-6),
                            { role: 'user', content: message }
                        ],
                        model: 'openai',
                        seed: 42
                    })
                });

                const data = await response.json();
                const aiMessage = data?.choices?.[0]?.message?.content || (currentLang === 'ar' ? 'عذراً، حدث خطأ' : 'Sorry, an error occurred');
                
                loadingMsg.remove();
                
                if (containsInappropriateContent(aiMessage)) {
                    addChatMessage('ai', currentLang === 'ar' ? 'عذراً، لا يمكنني تقديم هذا المحتوى.' : 'Sorry, I cannot provide that content.');
                } else {
                    addChatMessage('ai', aiMessage);
                    chatHistory.push({ role: 'user', content: message }, { role: 'assistant', content: aiMessage });
                    
                    // Extract prompt and apply to image input
                    extractAndApplyPrompt(aiMessage);
                }
                
            } catch (error) {
                loadingMsg.remove();
                addChatMessage('ai', currentLang === 'ar' ? '❌ فشل الاتصال' : '❌ Connection failed');
            } finally {
                btn.disabled = false;
            }
        }

        function extractAndApplyPrompt(aiMessage) {
            // Try to extract the prompt from AI response
            const lines = aiMessage.split('\n');
            let extractedPrompt = '';
            let inPrompt = false;
            
            for (let line of lines) {
                if (line.toLowerCase().includes('prompt') && line.includes(':')) {
                    inPrompt = true;
                    continue;
                }
                if (inPrompt && (line.toLowerCase().includes('recommended') || line.toLowerCase().includes('settings') || line.toLowerCase().includes('إعدادات'))) {
                    break;
                }
                if (inPrompt && line.trim()) {
                    extractedPrompt += line.trim() + ' ';
                }
            }
            
            if (extractedPrompt.trim()) {
                document.getElementById('imagePrompt').value = extractedPrompt.trim();
            }

            // Try to extract model recommendation
            const modelMatch = aiMessage.match(/model[:\s]+(flux-pro|flux-realism|flux-anime|flux-3d|flux|turbo)/i);
            if (modelMatch) {
                document.getElementById('modelSelect').value = modelMatch[1].toLowerCase();
            }

            // Try to extract size recommendation
            const sizeMatch = aiMessage.match(/size[:\s]+(square|landscape|portrait|wide|fullhd|full\s*hd)/i);
            if (sizeMatch) {
                const sizeMap = {
                    'square': '1024x1024',
                    'landscape': '1024x768',
                    'portrait': '768x1024',
                    'wide': '1280x720',
                    'fullhd': '1920x1080',
                    'full hd': '1920x1080'
                };
                const sizeKey = sizeMatch[1].toLowerCase().replace(/\s/g, '');
                const size = sizeMap[sizeKey];
                if (size) {
                    document.getElementById('sizeSelect').value = size;
                }
            }
        }

        function addChatMessage(type, message) {
            const container = document.getElementById('chatContainer');
            const div = document.createElement('div');
            div.className = `chat-message ${type}`;
            div.innerHTML = `
                <div class="label">${type === 'user' ? (currentLang === 'ar' ? '👤 أنت' : '👤 You') : '🤖 AI'}</div>
                <div style="white-space: pre-wrap;">${message}</div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return div;
        }

        async function generateImage() {
            const prompt = document.getElementById('imagePrompt').value.trim();
            const model = document.getElementById('modelSelect').value;
            const size = document.getElementById('sizeSelect').value;
            const seed = document.getElementById('seedInput').value;
            const enhance = document.getElementById('enhanceSelect').value;
            const [width, height] = size.split('x');
            
            if (!prompt) {
                showAlert('error', currentLang === 'ar' ? 'الرجاء إدخال وصف للصورة' : 'Please enter an image description');
                return;
            }

            if (containsInappropriateContent(prompt)) {
                showAlert('error', currentLang === 'ar' ? '❌ المحتوى غير مناسب.' : '❌ Inappropriate content detected.');
                return;
            }

            const now = Date.now();
            if (now - lastRequestTime < MIN_REQUEST_INTERVAL) {
                const waitTime = Math.ceil((MIN_REQUEST_INTERVAL - (now - lastRequestTime)) / 1000);
                showAlert('warning', currentLang === 'ar' ? `⏱️ انتظر ${waitTime} ثانية` : `⏱️ Wait ${waitTime}s`);
                return;
            }

            lastRequestTime = now;
            
            const output = document.getElementById('imageOutput');
            output.innerHTML = '<div class="loading"><div class="spinner"></div><p>Generating image with your settings...</p></div>';

            try {
                // Using the correct Pollinations.AI format
                const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=${width}&height=${height}&seed=${seed}&model=${model}&nologo=true&enhance=${enhance}`;
                
                console.log('Generating image with URL:', imageUrl);
                
                const img = new Image();
                img.onload = () => {
                    output.innerHTML = '';
                    addImageToGallery(imageUrl, prompt, size, model, seed);
                    
                    // Auto-increment seed for next generation
                    document.getElementById('seedInput').value = parseInt(seed) + 1;
                };
                img.onerror = () => {
                    showAlert('error', currentLang === 'ar' ? 'فشل توليد الصورة. جرب seed آخر أو موديل مختلف.' : 'Failed to generate image. Try a different seed or model.');
                    output.innerHTML = '';
                };
                img.src = imageUrl;
                
            } catch (error) {
                console.error('Image generation error:', error);
                showAlert('error', currentLang === 'ar' ? 'حدث خطأ' : 'An error occurred');
                output.innerHTML = '';
            }
        }

        function addImageToGallery(url, prompt, size, model, seed) {
            const gallery = document.getElementById('imageGallery');
            const div = document.createElement('div');
            div.className = 'image-item';
            
            const imageData = {
                url: url,
                prompt: prompt,
                size: size,
                model: model,
                seed: seed,
                timestamp: Date.now()
            };
            
            generatedImages.unshift(imageData);
            
            div.innerHTML = `
                <img src="${url}" alt="${prompt}" loading="lazy">
                <div class="image-actions">
                    <button class="icon-btn" onclick="downloadImage('${url}', '${prompt}')" title="${currentLang === 'ar' ? 'تحميل' : 'Download'}">⬇️</button>
                    <button class="icon-btn" onclick="viewFullImage('${url}')" title="${currentLang === 'ar' ? 'عرض' : 'View'}">👁️</button>
                    <button class="icon-btn" onclick="copyPrompt('${prompt.replace(/'/g, "\\'")}')" title="${currentLang === 'ar' ? 'نسخ الوصف' : 'Copy prompt'}">📋</button>
                    <button class="icon-btn" onclick="regenerateWithSeed('${prompt.replace(/'/g, "\\'")}', '${model}', '${size}', ${seed})" title="${currentLang === 'ar' ? 'إعادة توليد' : 'Regenerate'}">🔄</button>
                </div>
            `;
            
            gallery.insertBefore(div, gallery.firstChild);
        }

        async function downloadImage(url, prompt) {
            try {
                // Show loading indicator
                showAlert('warning', currentLang === 'ar' ? '⏳ جاري التحميل...' : '⏳ Downloading...');
                
                // Fetch the image with full quality
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Download failed');
                }
                
                const blob = await response.blob();
                const blobUrl = window.URL.createObjectURL(blob);
                
                // Create download link
                const a = document.createElement('a');
                a.href = blobUrl;
                a.download = `pollinations_${prompt.substring(0, 30).replace(/[^a-z0-9]/gi, '_')}_${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                // Clean up
                window.URL.revokeObjectURL(blobUrl);
                
                showAlert('success', currentLang === 'ar' ? '✅ تم التحميل بنجاح' : '✅ Downloaded successfully');
            } catch (error) {
                console.error('Download error:', error);
                showAlert('error', currentLang === 'ar' ? '❌ فشل التحميل. جرب النقر بالزر الأيمن > حفظ الصورة' : '❌ Download failed. Try right-click > Save image');
            }
        }

        function viewFullImage(url) {
            window.open(url, '_blank');
        }

        function copyPrompt(prompt) {
            navigator.clipboard.writeText(prompt).then(() => {
                showAlert('success', currentLang === 'ar' ? '✅ تم نسخ الوصف' : '✅ Prompt copied');
            }).catch(() => {
                showAlert('error', currentLang === 'ar' ? '❌ فشل النسخ' : '❌ Copy failed');
            });
        }

        function regenerateWithSeed(prompt, model, size, seed) {
            document.getElementById('imagePrompt').value = prompt;
            document.getElementById('modelSelect').value = model;
            document.getElementById('sizeSelect').value = size;
            document.getElementById('seedInput').value = parseInt(seed) + 1; // New variation
            
            showAlert('success', currentLang === 'ar' ? '✅ تم تطبيق الإعدادات. اضغط توليد للحصول على variation جديد!' : '✅ Settings applied. Click Generate for a new variation!');
        }

        function randomSeed() {
            const randomNum = Math.floor(Math.random() * 9999) + 1;
            document.getElementById('seedInput').value = randomNum;
            showAlert('success', currentLang === 'ar' ? `🎲 Seed عشوائي: ${randomNum}` : `🎲 Random seed: ${randomNum}`);
        }

        // Text Chat Functions
        async function sendTextChat() {
            const input = document.getElementById('textChatInput');
            const message = input.value.trim();
            
            if (!message) return;

            if (containsInappropriateContent(message)) {
                showAlert('error', currentLang === 'ar' ? '❌ المحتوى غير مناسب. الرجاء استخدام لغة محترمة.' : '❌ Inappropriate content. Please use respectful language.');
                return;
            }

            const now = Date.now();
            if (now - lastRequestTime < MIN_REQUEST_INTERVAL) {
                const waitTime = Math.ceil((MIN_REQUEST_INTERVAL - (now - lastRequestTime)) / 1000);
                showAlert('warning', currentLang === 'ar' ? `⏱️ انتظر ${waitTime} ثانية` : `⏱️ Wait ${waitTime}s`);
                return;
            }

            lastRequestTime = now;

            addTextChatMessage('user', message);
            input.value = '';
            
            const btn = document.getElementById('textChatBtn');
            btn.disabled = true;

            const loadingMsg = addTextChatMessage('ai', currentLang === 'ar' ? '🤖 جاري التفكير...' : '🤖 Thinking...');

            try {
                const systemPrompt = `You are a helpful and respectful AI assistant. Answer clearly and respectfully. Do not use inappropriate language. Help users with questions, creative writing, learning, advice, and general conversation.

${currentLang === 'ar' ? 'Respond in Arabic for Arabic messages.' : ''}`;

                const response = await fetch('https://text.pollinations.ai/openai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        messages: [
                            { role: 'system', content: systemPrompt },
                            ...textChatHistory.slice(-8),
                            { role: 'user', content: message }
                        ],
                        model: 'openai',
                        seed: 42
                    })
                });

                const data = await response.json();
                const aiMessage = data?.choices?.[0]?.message?.content || (currentLang === 'ar' ? 'عذراً، حدث خطأ' : 'Sorry, an error occurred');
                
                loadingMsg.remove();
                
                if (containsInappropriateContent(aiMessage)) {
                    addTextChatMessage('ai', currentLang === 'ar' ? 'عذراً، لا يمكنني تقديم هذا المحتوى.' : 'Sorry, I cannot provide that content.');
                } else {
                    addTextChatMessage('ai', aiMessage);
                    textChatHistory.push({ role: 'user', content: message }, { role: 'assistant', content: aiMessage });
                    
                    if (textChatHistory.length > 16) {
                        textChatHistory = textChatHistory.slice(-16);
                    }
                }
                
            } catch (error) {
                loadingMsg.remove();
                addTextChatMessage('ai', currentLang === 'ar' ? '❌ فشل الاتصال' : '❌ Connection failed');
            } finally {
                btn.disabled = false;
            }
        }

        function addTextChatMessage(type, message) {
            const container = document.getElementById('textChatContainer');
            const div = document.createElement('div');
            div.className = `chat-message ${type}`;
            div.innerHTML = `
                <div class="label">${type === 'user' ? (currentLang === 'ar' ? '👤 أنت' : '👤 You') : '🤖 AI'}</div>
                <div style="white-space: pre-wrap;">${message}</div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
            return div;
        }

        function clearTextChat() {
            if (confirm(currentLang === 'ar' ? 'هل تريد مسح المحادثة؟' : 'Clear chat history?')) {
                const container = document.getElementById('textChatContainer');
                container.innerHTML = `
                    <div class="chat-message ai">
                        <div class="label">${currentLang === 'ar' ? '🤖 المساعد الذكي' : '🤖 AI Assistant'}</div>
                        <div>${currentLang === 'ar' ? 'مرحباً! أنا مساعد ذكاء اصطناعي عام. أستطيع مساعدتك في الأسئلة، الكتابة الإبداعية، الشروحات، النصائح، والمزيد. عمّا تريد أن نتحدث؟' : 'Hello! I\'m a general AI assistant. I can help you with questions, creative writing, explanations, advice, and more. What would you like to talk about?'}</div>
                    </div>
                `;
                textChatHistory = [];
            }
        }

        function clearGallery() {
            if (confirm(currentLang === 'ar' ? 'هل تريد مسح كل الصور؟' : 'Clear all images?')) {
                document.getElementById('imageGallery').innerHTML = '';
                generatedImages = [];
            }
        }

        function showAlert(type, message) {
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) existingAlert.remove();

            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            const section = document.querySelector('.section');
            if (section) {
                section.insertBefore(alert, section.firstChild);
            } else {
                const container = document.querySelector('.container');
                container.insertBefore(alert, container.firstChild);
            }
            
            setTimeout(() => alert.remove(), 4000);
        }

        // Update all data attributes when language changes
        function updateDataAttributes() {
            document.querySelectorAll('[data-en]').forEach(el => {
                if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                    const placeholder = el.getAttribute(`data-placeholder-${currentLang}`);
                    if (placeholder) el.placeholder = placeholder;
                } else {
                    const text = el.getAttribute(`data-${currentLang}`);
                    if (text) el.textContent = text;
                }
            });
        }

        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        document.getElementById('imagePrompt').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                generateImage();
            }
        });

        document.getElementById('textChatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendTextChat();
            }
        });
    </script>
</body>
</html>