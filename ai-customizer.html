<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="AI Portfolio Customizer - Build and customize your portfolio with AI assistance">
    <title>AI Portfolio Customizer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0a0e27;
            color: #e5e7eb;
            font-family: 'Inter', 'Segoe UI', sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        /* Header */
        .header {
            background-color: #0f1629;
            border-bottom: 2px solid #00d9ff;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #00d9ff;
            font-size: 24px;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header .subtitle {
            color: #9ca3af;
            font-size: 14px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .lang-switch {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid #00d9ff;
            color: #00d9ff;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .lang-switch:hover {
            background: #00d9ff;
            color: #0a0e27;
        }

        .back-btn {
            background: rgba(124, 58, 237, 0.1);
            border: 1px solid #7c3aed;
            color: #7c3aed;
            padding: 8px 16px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #7c3aed;
            color: white;
        }

        /* Main Container */
        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr 1fr;
            height: calc(100vh - 70px);
            gap: 0;
            overflow: hidden;
        }

        /* Panel Styles */
        .panel {
            background-color: #0f1629;
            border-right: 1px solid rgba(0, 217, 255, 0.2);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel:last-child {
            border-right: none;
        }

        .panel-header {
            background-color: #1a1f3a;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0, 217, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .panel-title {
            color: #00d9ff;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
        }

        .panel-content::-webkit-scrollbar {
            width: 8px;
        }

        .panel-content::-webkit-scrollbar-track {
            background: #0a0e27;
        }

        .panel-content::-webkit-scrollbar-thumb {
            background: #00d9ff;
            border-radius: 4px;
        }

        /* AI Assistant Panel */
        .api-key-section {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid #f59e0b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .api-key-section h3 {
            color: #f59e0b;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .api-key-section input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            color: #e5e7eb;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .api-key-section input:focus {
            outline: none;
            border-color: #f59e0b;
        }

        .api-key-section p {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 8px;
        }

        .api-key-section a {
            color: #f59e0b;
            text-decoration: none;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-btn {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            color: #00d9ff;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s ease;
            text-align: center;
        }

        .quick-btn:hover {
            background: rgba(0, 217, 255, 0.2);
            border-color: #00d9ff;
            transform: translateY(-2px);
        }

        .chat-container {
            flex: 1;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            overflow-y: auto;
            max-height: 300px;
        }

        .chat-message {
            margin-bottom: 15px;
            padding: 12px;
            border-radius: 8px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-message.user {
            background: rgba(0, 217, 255, 0.1);
            border-left: 3px solid #00d9ff;
        }

        .chat-message.ai {
            background: rgba(124, 58, 237, 0.1);
            border-left: 3px solid #7c3aed;
        }

        .chat-message .label {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .chat-message.user .label {
            color: #00d9ff;
        }

        .chat-message.ai .label {
            color: #7c3aed;
        }

        .chat-input-area {
            display: flex;
            gap: 10px;
        }

        .chat-input-area textarea {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            color: #e5e7eb;
            font-family: inherit;
            font-size: 13px;
            resize: none;
            height: 60px;
        }

        .chat-input-area textarea:focus {
            outline: none;
            border-color: #00d9ff;
        }

        .btn {
            background: linear-gradient(135deg, #00d9ff, #7c3aed);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 217, 255, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Code Editor Panel */
        .editor-actions {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            color: #00d9ff;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            background: rgba(0, 217, 255, 0.2);
            border-color: #00d9ff;
        }

        .CodeMirror {
            height: 100% !important;
            font-size: 14px;
            border-radius: 8px;
        }

        .editor-wrapper {
            flex: 1;
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 8px;
            overflow: hidden;
        }

        /* Live Preview Panel */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid #22c55e;
            color: #22c55e;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .preview-frame {
            flex: 1;
            width: 100%;
            height: 100%;
            border: 1px solid rgba(0, 217, 255, 0.2);
            border-radius: 8px;
            background: white;
            overflow: auto;
        }

        /* Responsive */
        @media (max-width: 1400px) {
            .main-container {
                grid-template-columns: 1fr;
                overflow-y: auto;
            }

            .panel {
                border-right: none;
                border-bottom: 1px solid rgba(0, 217, 255, 0.2);
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 10px;
            }

            .main-container {
                height: calc(100vh - 120px);
            }

            .panel {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div>
            <h1>🤖 AI Portfolio Customizer</h1>
            <div class="subtitle" data-en="Customize your portfolio in real-time with AI assistance powered by Groq" data-ar="خصص بورتفوليوك مباشرة بمساعدة الذكاء الصناعي من Groq">Customize your portfolio in real-time with AI assistance powered by Groq</div>
        </div>
        <div class="header-actions">
            <button class="lang-switch" onclick="toggleLanguage()">العربية</button>
            <a href="index.html" class="back-btn">← <span data-en="Back to Portfolio" data-ar="العودة للبورتفوليو">Back to Portfolio</span></a>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- AI Assistant Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">🧠 <span data-en="AI Assistant" data-ar="المساعد الذكي">AI Assistant</span></div>
            </div>
            <div class="panel-content">
                <div class="api-key-section">
                    <h3 data-en="Groq API Key" data-ar="مفتاح Groq API">Groq API Key</h3>
                    <input type="password" id="apiKey" placeholder="gsk_..." data-en-placeholder="Enter your Groq API key" data-ar-placeholder="أدخل مفتاح Groq API">
                    <p data-en="Get your free API key from" data-ar="احصل على مفتاح API مجاني من">Get your free API key from <a href="https://console.groq.com/keys" target="_blank">console.groq.com</a></p>
                </div>

                <div class="quick-actions">
                    <button class="quick-btn" onclick="quickAction('color')" data-en="🎨 Change Colors" data-ar="🎨 غير الألوان">🎨 Change Colors</button>
                    <button class="quick-btn" onclick="quickAction('font')" data-en="✍️ Change Font" data-ar="✍️ غير الخط">✍️ Change Font</button>
                    <button class="quick-btn" onclick="quickAction('section')" data-en="➕ Add Section" data-ar="➕ أضف قسم">➕ Add Section</button>
                    <button class="quick-btn" onclick="quickAction('animation')" data-en="✨ Add Animation" data-ar="✨ أضف حركة">✨ Add Animation</button>
                </div>

                <div class="chat-container" id="chatContainer">
                    <div class="chat-message ai">
                        <div class="label" data-en="AI Assistant" data-ar="المساعد الذكي">AI Assistant</div>
                        <div data-en="Hello! I'm your AI assistant powered by Groq's Llama 3.3 70B. I can help you customize your portfolio by modifying colors, fonts, adding sections, animations, and more. Just tell me what you want to change!" data-ar="مرحباً! أنا مساعدك الذكي المدعوم بـ Llama 3.3 70B من Groq. يمكنني مساعدتك في تخصيص بورتفوليوك بتعديل الألوان والخطوط وإضافة أقسام وحركات والمزيد. فقط أخبرني بما تريد تغييره!">Hello! I'm your AI assistant powered by Groq's Llama 3.3 70B. I can help you customize your portfolio by modifying colors, fonts, adding sections, animations, and more. Just tell me what you want to change!</div>
                    </div>
                </div>

                <div class="chat-input-area">
                    <textarea id="userInput" placeholder="Ask AI to customize your portfolio..." data-en-placeholder="Ask AI to customize your portfolio..." data-ar-placeholder="اسأل الذكاء الصناعي لتخصيص بورتفوليوك..."></textarea>
                    <button class="btn" onclick="sendMessage()" id="sendBtn" data-en="Send" data-ar="إرسال">Send</button>
                </div>
            </div>
        </div>

        <!-- Code Editor Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">💻 <span data-en="Code Editor" data-ar="محرر الكود">Code Editor</span></div>
                <div class="editor-actions">
                    <button class="icon-btn" onclick="copyCode()" data-en="📋 Copy" data-ar="📋 نسخ">📋 Copy</button>
                    <button class="icon-btn" onclick="downloadCode()" data-en="💾 Download" data-ar="💾 تحميل">💾 Download</button>
                    <button class="icon-btn" onclick="resetCode()" data-en="🔄 Reset" data-ar="🔄 إعادة">🔄 Reset</button>
                </div>
            </div>
            <div class="panel-content" style="padding: 0;">
                <div class="editor-wrapper">
                    <textarea id="codeEditor"></textarea>
                </div>
            </div>
        </div>

        <!-- Live Preview Panel -->
        <div class="panel">
            <div class="panel-header">
                <div class="panel-title">👁️ <span data-en="Live Preview" data-ar="معاينة مباشرة">Live Preview</span></div>
                <div class="status-indicator">
                    <span class="status-dot"></span>
                    <span data-en="Live" data-ar="مباشر">Live</span>
                </div>
            </div>
            <div class="panel-content" style="padding: 0;">
                <iframe class="preview-frame" id="previewFrame"></iframe>
            </div>
        </div>
    </div>

    <script>
        let editor;
        let currentLanguage = 'en';
        const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';

        // Initialize CodeMirror
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const session = JSON.parse(localStorage.getItem('session') || sessionStorage.getItem('session') || 'null');
            if (!session || !session.loggedIn) {
                // Redirect to auth page if not logged in
                window.location.href = 'auth.html';
                return;
            }

            editor = CodeMirror.fromTextArea(document.getElementById('codeEditor'), {
                mode: 'htmlmixed',
                theme: 'dracula',
                lineNumbers: true,
                autoCloseTags: true,
                autoCloseBrackets: true,
                matchBrackets: true,
                indentUnit: 4,
                tabSize: 4,
                lineWrapping: true
            });

            // Set initial template
            const initialCode = getPortfolioTemplate();
            editor.setValue(initialCode);

            // Update preview on change
            editor.on('change', function() {
                updatePreview();
            });

            // Initial preview
            updatePreview();

            // Load saved API key
            const savedKey = localStorage.getItem('groq_api_key');
            if (savedKey) {
                document.getElementById('apiKey').value = savedKey;
            }

            // Save API key on change
            document.getElementById('apiKey').addEventListener('change', function() {
                localStorage.setItem('groq_api_key', this.value);
            });

            // Enter to send
            document.getElementById('userInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        });

        function getPortfolioTemplate() {
            return `<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Mechatronics Engineer with 8+ years in robotics, automation, and innovation. Expert in 3D design, Python development, and complex system analysis. Creator of Bu Saif humanoid robot and contributor to US Patent 11573635.">
    <meta name="keywords" content="Mechatronics Engineer, Robotics, Automation, Python, 3D Design, Bu Saif, UAE, Abu Dhabi">
    <meta name="author" content="Bassam Walid Aljazzar">
    <title>Bassam Aljazzar - Mechatronics Engineer Portfolio</title>
    <script type="module" src="https://unpkg.com/@splinetool/viewer@1.10.76/build/spline-viewer.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #0a0a0a;
            color: #00ff00;
            font-family: 'Courier New', 'Monaco', monospace;
            overflow: hidden;
            height: 100vh;
            max-height: 100vh;
            margin: 0;
            padding: 0;
        }

        /* Header */
        .header {
            background-color: #0f0f0f;
            border-bottom: 2px solid #00ff00;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #00ff00;
            font-size: 24px;
            margin: 0;
        }

        .header .subtitle {
            color: #888;
            font-size: 14px;
        }

        .nav {
            color: #888;
            font-size: 12px;
        }

        .nav a {
            color: #00ff00;
            text-decoration: none;
            margin: 0 8px;
            cursor: pointer;
        }

        .nav a:hover {
            color: #5BCEFA;
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 70px);
            max-height: calc(100vh - 70px);
            gap: 0;
            overflow: hidden;
        }

        /* 3D Viewer Section (Left) */
        .viewer-section {
            flex: 0 0 40%;
            background-color: #0f0f0f;
            border-right: 2px solid #00ff00;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        spline-viewer {
            width: 100%;
            height: 100%;
            border: none;
            pointer-events: auto;
            touch-action: pan-x pan-y pinch-zoom;
        }

        /* Terminal Section (Right) */
        .terminal-section {
            flex: 1;
            background-color: #0a0a0a;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
            min-height: 0;
        }

        .terminal-box {
            background-color: #0f0f0f;
            border: 2px solid #00ff00;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            height: 100%;
            max-height: 100%;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
            overflow: hidden;
        }

        .terminal-header {
            background-color: #1a1a1a;
            padding: 10px 15px;
            border-bottom: 1px solid #00ff00;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ff5f56;
        }

        .terminal-button:nth-child(2) {
            background-color: #ffbd2e;
        }

        .terminal-button:nth-child(3) {
            background-color: #27c93f;
        }

        .terminal-title {
            flex: 1;
            text-align: center;
            color: #888;
            font-size: 12px;
        }

        .terminal-output {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px;
            padding-bottom: 10px;
            font-size: 14px;
            min-height: 0;
            -webkit-overflow-scrolling: touch;
        }

        .terminal-output::-webkit-scrollbar {
            width: 8px;
        }

        .terminal-output::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        .terminal-output::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 4px;
        }

        .output-line {
            margin-bottom: 8px;
            word-wrap: break-word;
        }

        .prompt-line {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .username {
            color: #5BCEFA;
        }

        .separator {
            color: #fff;
        }

        .directory {
            color: #F5A9B8;
        }

        .command {
            color: #ffa500;
        }

        .terminal-footer {
            background-color: #1a1a1a;
            padding: 15px;
            border-top: 1px solid #00ff00;
            flex-shrink: 0;
            min-height: 60px;
        }

        .welcome-text {
            color: #888;
            font-size: 12px;
            line-height: 1.6;
            text-align: center;
        }

        .welcome-text .highlight {
            color: #ffa500;
            font-weight: bold;
        }

        /* Chat mode styles */
        .chat-message {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #5BCEFA;
            background: rgba(91, 206, 250, 0.05);
        }

        .ai-thinking {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .terminal-input-line {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #0a0a0a;
            border-top: 1px solid #333;
            flex-shrink: 0;
            min-height: 50px;
            cursor: text;
            -webkit-tap-highlight-color: transparent;
        }

        .terminal-input-line:hover {
            background-color: #0f0f0f;
        }

        #commandInput {
            background: transparent;
            border: none;
            outline: none;
            color: #00ff00;
            font-family: inherit;
            font-size: inherit;
            flex: 1;
            caret-color: #00ff00;
            margin-left: 5px;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        #commandInput:focus {
            outline: none;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-container {
                flex-direction: column;
            }

            .viewer-section {
                flex: 0 0 300px;
                min-height: 300px;
                border-right: none;
                border-bottom: 2px solid #00ff00;
            }

            .terminal-section {
                flex: 1;
                min-height: 400px;
                display: flex;
                flex-direction: column;
            }

            .terminal-box {
                max-height: calc(100vh - 350px);
                min-height: 400px;
            }

            .terminal-output {
                font-size: 13px;
                padding-bottom: 5px;
            }

            .terminal-footer {
                flex-shrink: 0;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
                height: 100vh;
                max-height: 100vh;
                overflow: hidden;
            }

            .main-container {
                height: calc(100vh - 120px);
                max-height: calc(100vh - 120px);
            }

            .header {
                flex-direction: column;
                gap: 10px;
                padding: 12px 15px;
            }

            .header h1 {
                font-size: 20px;
            }

            .header .subtitle {
                font-size: 12px;
            }

            .nav {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                font-size: 11px;
            }

            .nav a {
                margin: 0 5px;
            }

            .viewer-section {
                flex: 0 0 250px;
                min-height: 250px;
            }

            .terminal-section {
                padding: 10px;
                min-height: 350px;
            }

            .terminal-box {
                border-radius: 0;
                max-height: calc(100vh - 320px);
                min-height: 350px;
            }

            .terminal-output {
                padding: 15px;
                padding-bottom: 5px;
                font-size: 12px;
                flex: 1;
                min-height: 0;
            }

            .terminal-input-line {
                padding: 12px;
                font-size: 12px;
                flex-shrink: 0;
            }

            .terminal-footer {
                padding: 12px;
                flex-shrink: 0;
            }

            .welcome-text {
                font-size: 10px;
            }

            #commandInput {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 18px;
            }

            .header .subtitle {
                font-size: 11px;
            }

            .nav {
                font-size: 10px;
            }

            .nav a {
                margin: 2px 3px;
            }

            .viewer-section {
                flex: 0 0 200px;
                min-height: 200px;
            }

            .terminal-section {
                padding: 5px;
                min-height: 300px;
            }

            .terminal-box {
                max-height: calc(100vh - 280px);
                min-height: 300px;
            }

            .terminal-header {
                padding: 8px 12px;
                flex-shrink: 0;
            }

            .terminal-title {
                font-size: 11px;
            }

            .terminal-output {
                padding: 12px;
                padding-bottom: 5px;
                font-size: 11px;
                flex: 1;
                min-height: 0;
            }

            .terminal-input-line {
                padding: 10px;
                font-size: 11px;
                flex-shrink: 0;
            }

            .terminal-footer {
                padding: 10px;
                flex-shrink: 0;
            }

            .welcome-text {
                font-size: 9px;
                line-height: 1.4;
            }

            #commandInput {
                font-size: 11px;
            }

            .username, .directory, .separator {
                font-size: 11px;
            }

            /* Make pre text smaller on mobile */
            pre {
                font-size: 0.5em !important;
            }
        }

        /* Landscape mode for mobile */
        @media (max-width: 900px) and (orientation: landscape) {
            .main-container {
                flex-direction: row;
            }

            .viewer-section {
                flex: 0 0 35%;
                border-right: 2px solid #00ff00;
                border-bottom: none;
            }

            .terminal-section {
                flex: 1;
            }
        }

        /* Very small screens */
        @media (max-width: 320px) {
            .main-container {
                height: calc(100vh - 100px);
                max-height: calc(100vh - 100px);
            }

            .header h1 {
                font-size: 16px;
            }

            .nav a {
                font-size: 9px;
                margin: 2px;
            }

            .viewer-section {
                flex: 0 0 180px;
                min-height: 180px;
            }

            .terminal-box {
                max-height: calc(100vh - 250px);
                min-height: 280px;
            }

            .terminal-output,
            .terminal-input-line,
            #commandInput {
                font-size: 10px;
            }

            .terminal-output {
                padding: 10px;
                padding-bottom: 5px;
            }

            .welcome-text {
                font-size: 8px;
            }

            .terminal-footer {
                padding: 8px;
                flex-shrink: 0;
            }
        }

        /* iOS Safari fixes */
        @supports (-webkit-touch-callout: none) {
            body {
                height: -webkit-fill-available;
            }
            
            .main-container {
                height: calc(100vh - 70px);
                height: calc(var(--vh, 1vh) * 100 - 70px);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div>
            <h1>Bassam Walid Aljazzar</h1>
            <div class="subtitle">Mechatronics Engineer</div>
        </div>
        <div class="nav">
            <a onclick="executeNavCommand('help')">help</a> |
            <a onclick="executeNavCommand('about')">about</a> |
            <a onclick="executeNavCommand('cd experience')">experience</a> |
            <a onclick="executeNavCommand('education')">education</a> |
            <a onclick="executeNavCommand('skills')">skills</a> |
            <a onclick="executeNavCommand('cd projects')">projects</a> |
            <a onclick="executeNavCommand('contact')">contact</a> |
            <a onclick="executeNavCommand('chatbot')" style="background: linear-gradient(90deg, #00ff00, #5BCEFA); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: bold;">🤖 chatbot</a> |
            <a onclick="executeNavCommand('clear')">clear</a>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- 3D Viewer Section (Left) -->
        <div class="viewer-section">
            <spline-viewer url="https://prod.spline.design/eBO7I-xKw00YnaYL/scene.splinecode"></spline-viewer>
        </div>

        <!-- Terminal Section (Right) -->
        <div class="terminal-section">
            <div class="terminal-box">
                <!-- Terminal Header -->
                <div class="terminal-header">
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                    <div class="terminal-button"></div>
                    <div class="terminal-title">bassam@portfolio:~</div>
                </div>

                <!-- Terminal Output -->
                <div class="terminal-output" id="terminalOutput">
                    <!-- Output will be inserted here -->
                </div>

                <!-- Terminal Input -->
                <div class="terminal-input-line">
                    <span class="username">bassam@portfolio</span>
                    <span class="separator">:</span>
                    <span class="directory" id="currentDir">~</span>
                    <span class="separator">$ </span>
                    <input type="text" id="commandInput" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
                </div>

                <!-- Terminal Footer (Fixed Welcome Text) -->
                <div class="terminal-footer">
                    <div class="welcome-text">
                        Type <span class="highlight">'help'</span> to see all available commands | 
                        Type <span class="highlight">'chatbot'</span> to chat with AI 🤖 | 
                        Type <span class="highlight">'ls'</span> to explore the file system<br>
                        Tip: Use <span class="highlight">TAB</span> for auto-completion and <span class="highlight">↑↓</span> arrows for command history
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const terminalOutput = document.getElementById('terminalOutput');
        const commandInput = document.getElementById('commandInput');
        const currentDirElement = document.getElementById('currentDir');
        let commandHistory = [];
        let historyIndex = -1;
        let currentDir = '~';
        let chatMode = false;
        let chatHistory = [];
        
        // Google Sheets Analytics Configuration
        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbxWblq8swF_Q8YgyMNOufr1S4hcM5pkJY5qNKfJjDRNAxbeVFaoF79hFjroxHZdLV_KMg/exec';
        
        // Generate unique session ID
        const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        
        // Detect user info
        let userCountry = 'Unknown';
        let userDevice = /Mobile|Android|iPhone|iPad/i.test(navigator.userAgent) ? 'Mobile' : 'Desktop';
        let userBrowser = navigator.userAgent.includes('Chrome') ? 'Chrome' : 
                          navigator.userAgent.includes('Firefox') ? 'Firefox' : 
                          navigator.userAgent.includes('Safari') ? 'Safari' : 'Other';

        // Analytics Functions
        async function getCountry() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                userCountry = data.country_name || 'Unknown';
            } catch (error) {
                userCountry = 'Unknown';
            }
        }

        async function logVisitor() {
            if (!GOOGLE_SHEET_URL) return;
            
            try {
                await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'visitor',
                        country: userCountry,
                        device: userDevice,
                        browser: userBrowser,
                        page: 'Home'
                    })
                });
            } catch (error) {
                console.log('Analytics logging failed (silent)');
            }
        }

        async function logChatMessage(userMsg, aiMsg) {
            if (!GOOGLE_SHEET_URL) return;
            
            try {
                await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'chat',
                        userMessage: userMsg,
                        aiResponse: aiMsg,
                        sessionId: sessionId,
                        country: userCountry
                    })
                });
            } catch (error) {
                console.log('Chat logging failed (silent)');
            }
        }

        // File system (same as before)
        const fileSystem = {
            '~': {
                type: 'dir',
                contents: {
                    'about.txt': { 
                        type: 'file', 
                        content: `Name: Bassam Walid Aljazzar
Role: Mechatronics Engineer / Electromechanical Engineer / Robotics Engineer
Location: Abu Dhabi, United Arab Emirates
Nationality: Palestinian

Bio:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
As a Mechatronics Engineer with 8 years of experience, I am an expert in 
3D design, complex system analysis and modifications, and Python development. 
I have a solid educational background and research experience as a research 
assistant at UAE University. 

I have built a Humanoid robot named "Bu Saif" and contributed to a patent 
(US11573635) for a face mask with EMG sensors for communication. 

I possess excellent communication and leadership skills and have a passion 
for robotics and automation. I am confident that I can bring innovation, 
quality, and creativity to any organization.

Interests:
  • Drawing
  • 3D Designing
  • Kung Fu
  • Robotics

Languages:
  • Arabic (Native)
  • English (Advanced)` 
                    },
                    'skills.txt': { 
                        type: 'file', 
                        content: `Technical Skills
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

3D Design & CAD:
  • SolidWorks 3D Design       ⭐⭐⭐⭐⭐ Expert
  • Fusion 360 3D Design       ⭐⭐⭐⭐⭐ Expert
  • Autodesk AutoCAD           ⭐⭐⭐⭐⭐ Expert

Programming & Software:
  • Python Programming         ⭐⭐⭐⭐ Experienced
  • ROS (Robot Operating Sys)  ⭐⭐⭐⭐ Skillful
  • Embedded Systems           ⭐⭐⭐⭐⭐ Expert
  • Microsoft Office           ⭐⭐⭐⭐⭐ Expert

Robotics & Electronics:
  • Robotics                   ⭐⭐⭐⭐ Experienced
  • Electronics Hardware       ⭐⭐⭐⭐⭐ Expert
  • Proteus                    ⭐⭐⭐⭐⭐ Expert

Manufacturing & Machines:
  • CNC Machines               ⭐⭐⭐⭐ Experienced
  • Laser Cutting Machines     ⭐⭐⭐⭐⭐ Expert
  • 3D Printing Machine        ⭐⭐⭐⭐⭐ Expert

Specializations:
  ✓ Mechatronics Systems Design
  ✓ Complex System Analysis & Modifications
  ✓ 3D Design & Prototyping
  ✓ Robotics & Automation
  ✓ Embedded Systems Development
  ✓ Python Development
  ✓ PLC Programming
  ✓ Solar Energy Systems` 
                    },
                    'contact.txt': { 
                        type: 'file', 
                        content: `Contact Information
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📧 Email:    b_aljazzar@yahoo.com
📱 Phone:    +971 56 611 3381
📍 Location: Abu Dhabi, United Arab Emirates
💼 LinkedIn: https://www.linkedin.com/in/bassam-aljazzar

Availability:
  • Open for full-time opportunities
  • Available for consulting projects
  • Open to collaboration on robotics projects

Response Time:
  • Usually within 24 hours
  • For urgent matters, please call

Feel free to reach out for:
  ✓ Job opportunities
  ✓ Robotics & Mechatronics consulting
  ✓ Research collaboration
  ✓ Technical workshops & training
  ✓ Speaking engagements` 
                    },
                    'education.txt': { 
                        type: 'file', 
                        content: `Education Background
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🎓 Bachelor of Science in Mechatronics Engineering
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

University: Al-Azhar University-Gaza
Location: Gaza, Palestine
Duration: October 2011 - May 2017
Degree: BSc in Mechatronics Engineering

About Mechatronics Engineering:
Mechatronics engineering is a multidisciplinary field that combines 
principles of mechanical, electrical, and computer engineering to 
create complex systems that are efficient, reliable, and versatile.

Graduation Project: "Shrimp Rover Robot"
The graduation project explained the meaning of Mechatronics, as it 
was a robot combining Mechanics, Electronics, and Control.` 
                    },
                    'projects': {
                        type: 'dir',
                        contents: {
                            'README.md': { 
                                type: 'file', 
                                content: `My Projects & Achievements
═══════════════════════════════════════════════════════════════════

Use 'ls' to see all projects, then 'cat <filename>' to read details.

Featured Projects:
  • busaif-2020.md    - Bu Saif Humanoid Robot (Latest)
  • busaif-2019.md    - Bu Saif Robot (GITEX 2019)
  • meta-touch.md     - Meta Touch Elevator Project
  • shrimp-rover.md   - Shrimp Rover Robot
  • patent.md         - US Patent 11573635` 
                            },
                            'busaif-2020.md': { 
                                type: 'file', 
                                content: `Bu Saif Humanoid Robot 2020-2021
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

I built a Python program for Bu Saif to perform a mini-mental state 
examination (MMSE). The program includes questions that the robot 
asks patients and automatically evaluates answers.

Features:
  ✓ Works to read attention and interaction
  ✓ Calculates response time automatically
  ✓ Provides real-time feedback

Collaboration: UAE University & Dubai Health Authority
Focus: Treatment of elderly with cognitive functions

Status: ✅ Completed & Deployed` 
                            },
                            'busaif-2019.md': { 
                                type: 'file', 
                                content: `Bu Saif Humanoid Robot 2019
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Built Humanoid Intelligent Robot "Bu Saif" from scratch, presented 
at GITEX 2019 Exhibition in Dubai.

Features:
  • Python-based NLP
  • Understands Arabic human text
  • Can respond naturally
  • Silicon head with actuators
  • Body with arms

Exhibition: GITEX 2019, Dubai, UAE
Status: ✅ Successfully Exhibited` 
                            },
                            'meta-touch.md': { 
                                type: 'file', 
                                content: `Meta Touch Project 2020
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Developed touchless elevator button system to avoid COVID-19 spread.

Features:
  ✓ No physical contact required
  ✓ Compatible with existing elevators
  ✓ Fast response time

Impact: Helped reduce virus transmission
Status: ✅ Production & Commercial` 
                            },
                            'shrimp-rover.md': { 
                                type: 'file', 
                                content: `Shrimp Rover Robot 2016
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Graduation project - specialized robot with six wheels designed to 
overcome obstacles, inspired by shrimp movement.

Features:
  ✓ Six-wheeled configuration
  ✓ Independent motor control
  ✓ All-terrain capability

Status: ✅ Completed (Graduation Project)` 
                            },
                            'patent.md': { 
                                type: 'file', 
                                content: `United States Patent 11573635
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Title: Face mask for accurate location of sensors relative to a 
user's face, a communication enabling face mask, and a communication 
system including the face mask.

Patent Number: US11573635

Contributed to developing innovative face mask equipped with EMG 
sensors for communication purposes.

Link: https://patentimages.storage.googleapis.com/73/15/54/9ddd67aef63072/US11573635.pdf

Status: ✅ Patent Granted` 
                            }
                        }
                    },
                    'experience': {
                        type: 'dir',
                        contents: {
                            'README.md': { 
                                type: 'file', 
                                content: `Work Experience
═══════════════════════════════════════════════════════════════════

Positions:
  • current-job.txt   - Mechatronics Engineer (2021-Present)
  • research.txt      - Research Assistant (2019-2021)
  • fadel-trading.txt - Mechatronics Engineer (2018-2019)
  • flash-tech.txt    - Mechatronics Engineer (2017)` 
                            },
                            'current-job.txt': { 
                                type: 'file', 
                                content: `Mechatronics Engineer
Tatweer Middle East and Africa
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📅 June 2021 - Present
📍 Abu Dhabi, UAE
🏢 Ministry of Interior - Manufacturing Innovation Laboratory

Responsibilities:
  ✓ Develop innovative solutions for Ministry challenges
  ✓ Python development for custom software
  ✓ Embedded systems development
  ✓ Training courses and workshops
  ✓ Technical consulting

Status: 🟢 Current Position` 
                            },
                            'research.txt': { 
                                type: 'file', 
                                content: `Research Assistant
United Arab Emirates University
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📅 May 2019 - May 2021
📍 Al Ain, UAE

Key Projects:
  • Bu Saif Humanoid Robot
  • COVID-19 ventilator prototypes
  • Meta Touch project
  • Patent US11573635

Status: ✅ Completed` 
                            },
                            'fadel-trading.txt': { 
                                type: 'file', 
                                content: `Mechatronics Engineer
Fadel Al Dhaheri General Trading
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📅 November 2018 - April 2019
📍 Dubai, UAE

Responsibilities:
  • Massage chairs maintenance
  • Toy machines maintenance
  • Motherboards maintenance

Status: ✅ Completed` 
                            },
                            'flash-tech.txt': { 
                                type: 'file', 
                                content: `Mechatronics Engineer
Flash Tech Company
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📅 June 2017 - November 2017
📍 Gaza, Palestine

Responsibilities:
  • Solar energy systems installation
  • PLC programming
  • Electrical systems maintenance

Status: ✅ Completed` 
                            }
                        }
                    }
                }
            }
        };

        // Commands (same as before)
        const commands = {
            help: () => `Available Commands
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

File System:
  ls              - List directory contents
  cd <dir>        - Change directory
  pwd             - Print working directory
  cat <file>      - Display file contents
  tree            - Display directory tree
  cd ..           - Go to parent directory

Quick Info:
  about           - About Bassam Aljazzar
  skills          - Technical skills
  projects        - Projects overview
  experience      - Work experience
  education       - Educational background
  contact         - Contact information

AI Assistant:
  chatbot         - 🤖 Chat with AI about Bassam & Mechatronics

System:
  clear           - Clear terminal
  history         - Show command history
  help            - Show this help
  whoami          - Display current user
  date            - Display current date`,

            ls: (args) => {
                const path = args[0] || currentDir;
                const dir = getDirectory(path);
                
                if (!dir || dir.type !== 'dir') {
                    return `ls: cannot access '${path}': No such file or directory`;
                }
                
                const items = Object.keys(dir.contents);
                return items.map(item => {
                    const isDir = dir.contents[item].type === 'dir';
                    const color = isDir ? '#5BCEFA' : '#00ff00';
                    const suffix = isDir ? '/' : '';
                    return `<span style="color: ${color}; font-weight: ${isDir ? 'bold' : 'normal'}">${item}${suffix}</span>`;
                }).join('  ');
            },

            cd: (args) => {
                if (!args[0] || args[0] === '~') {
                    currentDir = '~';
                    currentDirElement.textContent = '~';
                    // Show welcome message when returning to home
                    setTimeout(() => {
                        addOutput(`<pre style="color: #00ff00; line-height: 1.2; font-size: 0.75em;">
 ██████╗  █████╗ ███████╗███████╗ █████╗ ███╗   ███╗     █████╗ ██╗         ██╗ █████╗ ███████╗███████╗ █████╗ ██████╗ 
 ██╔══██╗██╔══██╗██╔════╝██╔════╝██╔══██╗████╗ ████║    ██╔══██╗██║         ██║██╔══██╗╚══███╔╝╚══███╔╝██╔══██╗██╔══██╗
 ██████╔╝███████║███████╗███████╗███████║██╔████╔██║    ███████║██║         ██║███████║  ███╔╝   ███╔╝ ███████║██████╔╝
 ██╔══██╗██╔══██║╚════██║╚════██║██╔══██║██║╚██╔╝██║    ██╔══██║██║    ██   ██║██╔══██║ ███╔╝   ███╔╝  ██╔══██║██╔══██╗
 ██████╔╝██║  ██║███████║███████║██║  ██║██║ ╚═╝ ██║    ██║  ██║███████╗╚█████╔╝██║  ██║███████╗███████╗██║  ██║██║  ██║
 ╚═════╝ ╚═╝  ╚═╝╚══════╝╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝    ╚═╝  ╚═╝╚══════╝ ╚════╝ ╚═╝  ╚═╝╚══════╝╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝
</pre>`);
                        addOutput(`<span style="color: #5BCEFA; font-weight: bold;">Welcome to Bassam Aljazzar's Interactive Portfolio Terminal</span>

<span style="color: #F5A9B8;">Mechatronics Engineer | Robotics Specialist | Innovation Consultant</span>
<span style="color: #00ff00;">📍 Abu Dhabi, UAE | 8 Years Experience | Patent Holder (US11573635)</span>

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`);
                    }, 100);
                    return '';
                }
                
                const newDir = args[0];
                if (newDir === '..') {
                    if (currentDir !== '~') {
                        const parts = currentDir.split('/').filter(p => p !== '~');
                        parts.pop();
                        currentDir = parts.length > 0 ? `~/${parts.join('/')}` : '~';
                        currentDirElement.textContent = currentDir;
                    }
                    return '';
                }
                
                const targetPath = currentDir === '~' ? `~/${newDir}` : `${currentDir}/${newDir}`;
                const dir = getDirectory(targetPath);
                
                if (!dir) {
                    return `cd: ${newDir}: No such file or directory`;
                }
                
                if (dir.type !== 'dir') {
                    return `cd: ${newDir}: Not a directory`;
                }
                
                currentDir = targetPath;
                currentDirElement.textContent = currentDir;
                return '';
            },

            pwd: () => currentDir.replace('~', '/home/bassam'),

            cat: (args) => {
                if (!args[0]) {
                    return 'cat: missing file operand';
                }
                
                const file = getFile(args[0]);
                
                if (!file) {
                    return `cat: ${args[0]}: No such file or directory`;
                }
                
                if (file.type === 'dir') {
                    return `cat: ${args[0]}: Is a directory`;
                }
                
                return file.content;
            },

            tree: () => {
                const buildTree = (obj, prefix = '', isLast = true) => {
                    const keys = Object.keys(obj.contents || {});
                    let result = '';
                    
                    keys.forEach((key, index) => {
                        const isLastItem = index === keys.length - 1;
                        const item = obj.contents[key];
                        const connector = isLastItem ? '└── ' : '├── ';
                        const isDir = item.type === 'dir';
                        const color = isDir ? '#5BCEFA' : '#00ff00';
                        
                        result += `${prefix}${connector}<span style="color: ${color}; font-weight: ${isDir ? 'bold' : 'normal'}">${key}${isDir ? '/' : ''}</span>\n`;
                        
                        if (isDir && item.contents) {
                            const newPrefix = prefix + (isLastItem ? '    ' : '│   ');
                            result += buildTree(item, newPrefix, isLastItem);
                        }
                    });
                    
                    return result;
                };
                
                const dir = getDirectory(currentDir);
                return `<span style="color: #5BCEFA; font-weight: bold">${currentDir}/</span>\n` + buildTree(dir);
            },

            clear: () => {
                terminalOutput.innerHTML = '';
                return null;
            },

            whoami: () => 'bassam',

            date: () => new Date().toString(),

            echo: (args) => args.join(' '),

            history: () => commandHistory.map((cmd, i) => `  ${i + 1}  ${cmd}`).join('\n'),

            about: () => commands.cat(['about.txt']),
            skills: () => commands.cat(['skills.txt']),
            contact: () => commands.cat(['contact.txt']),
            education: () => commands.cat(['education.txt']),
            projects: () => 'Navigate: cd projects && ls && cat <project-file>',
            experience: () => 'Navigate: cd experience && ls && cat <position-file>',

            sudo: (args) => {
                const fullCmd = args.join(' ');
                if (fullCmd === 'rm -rf /') {
                    return '😱 Nice try! But I\'m not deleting my portfolio!';
                }
                return '[sudo] password for bassam: \nSorry, no sudo access here 😄';
            },

            chatbot: () => {
                chatMode = true;
                chatHistory = [];
                currentDirElement.textContent = '🤖 AI Chat';
                return `<span style="color: #5BCEFA; font-weight: bold;">🤖 AI Chatbot Activated!</span>

<span style="color: #00ff00;">I'm Bassam's AI assistant. I can help you with:</span>
  • Information about Bassam's background and experience
  • Details about his mechatronics projects
  • Explanations about mechatronics engineering
  • Questions about robotics and automation

<span style="color: #F5A9B8;">Type your question and press Enter to chat.</span>
<span style="color: #888;">Type 'exit' to return to terminal mode.</span>

<span style="color: #666; font-size: 0.9em;">📝 Note: Conversations are logged for quality improvement.</span>

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`;
            }
        };


// AI chat with Function Calling for Spline control
let lastRequestTime = 0;
const MIN_REQUEST_INTERVAL = 5500;

// 🎬 Spline Control Function
function triggerPatentView() {
  try {
    const splineViewer = document.querySelector('spline-viewer');
    
    if (!splineViewer) {
      console.warn('⚠️ Spline viewer not found');
      return { success: false, message: 'Spline viewer not available' };
    }
    
    console.log('🎬 Triggering patent view in 3D lab...');
    
    // جرّب الطرق المختلفة للتفاعل مع Spline
    try {
      // Method 1: Direct event emission
      if (typeof splineViewer.emitEvent === 'function') {
        splineViewer.emitEvent('mouseDown', 'RedMask');
      }
      
      // Method 2: Access through runtime (يشتغل بعد ما يحمّل)
      const tryRuntime = () => {
        if (splineViewer.runtime) {
          const mask = splineViewer.runtime.findObjectByName('RedMask') || 
                       splineViewer.runtime.findObjectByName('patent_mask');
          if (mask) {
            splineViewer.runtime.emitEvent('mouseDown', mask);
          }
        }
      };
      
      // جرّب فوراً وبعد delay
      tryRuntime();
      setTimeout(tryRuntime, 100);
      
    } catch (e) {
      console.log('Spline interaction attempt:', e.message);
    }
    
    // Visual feedback في الـ terminal
    addOutput(`<span style="color:#5BCEFA;">🎭 ← انظر للمختبر الافتراضي أعلاه! تم تفعيل عرض البراءة.</span>`);
    
    return { 
      success: true, 
      message: 'Patent view activated in 3D lab. User can click the red mask above the mannequin to view the patent document.' 
    };
    
  } catch (error) {
    console.error('❌ Spline control error:', error);
    return { success: false, message: error.message };
  }
}

async function sendChatMessage(userMessage) {
  console.log('🚀 Starting chat request...');
  
  if (window.__aiBusy) {
    return `<span style="color:#ffbd2e;">⏳ انتظر قليلاً...</span>`;
  }

  const now = Date.now();
  const timeSinceLastRequest = now - lastRequestTime;
  console.log(`⏱️ Time since last request: ${timeSinceLastRequest}ms`);
  
  if (timeSinceLastRequest < MIN_REQUEST_INTERVAL) {
    const waitTime = Math.ceil((MIN_REQUEST_INTERVAL - timeSinceLastRequest) / 1000);
    console.log(`⚠️ Rate limit triggered. Wait ${waitTime}s`);
    return `<span style="color:#ffa500;">⏱️ انتظر ${waitTime} ثانية قبل الرسالة التالية</span>`;
  }

  window.__aiBusy = true;
  lastRequestTime = now;

  const systemPrompt = `You are Bassam Aljazzar's AI assistant. Your role is to provide information about Bassam and answer questions about mechatronics engineering.

ABOUT BASSAM:
- Name: Bassam Walid Aljazzar
- Role: Mechatronics Engineer / Robotics Engineer
- Location: Abu Dhabi, UAE
- Experience: 8 years in robotics, automation, and innovation
- Nationality: Palestinian
- Languages: Arabic (Native), English (Advanced)

EDUCATION:
- BSc in Mechatronics Engineering from Al-Azhar University-Gaza (2011-2017)
- Graduation Project: "Shrimp Rover Robot" - a six-wheeled robot inspired by shrimp movement

CURRENT POSITION (June 2021 - Present):
- Mechatronics Engineer at Tatweer Middle East and Africa
- Consultant at UAE Ministry of Interior's Manufacturing Innovation Laboratory
- Develops innovative solutions, Python software, and embedded systems
- Conducts training courses and workshops

KEY PROJECTS:
1. Bu Saif Humanoid Robot (2020-2021): Python-based robot for mini-mental state examination (MMSE) for elderly patients with cognitive functions, in collaboration with UAE University and Dubai Health Authority
2. Bu Saif Humanoid Robot (2019): Arabic-speaking humanoid robot presented at GITEX 2019 Exhibition in Dubai
3. Meta Touch Project (2020): Touchless elevator button system to prevent COVID-19 transmission, now in commercial production
4. US Patent 11573635: Contributed to developing face mask with EMG sensors for communication. The patent document can be viewed by clicking the red mask in the 3D virtual lab.
5. Shrimp Rover Robot (2016): Graduation project with six-wheeled design for obstacle navigation

TECHNICAL SKILLS:
- 3D Design: SolidWorks, Fusion 360, AutoCAD (Expert level)
- Programming: Python (Experienced), ROS, Embedded Systems (Expert)
- Robotics & Electronics: Expert in robotics, electronics hardware, Proteus
- Manufacturing: CNC Machines, Laser Cutting, 3D Printing (Expert)

WORK EXPERIENCE:
- Research Assistant at UAE University (May 2019 - May 2021): Led Bu Saif robot project, COVID-19 prototypes
- Mechatronics Engineer at Fadel Al Dhaheri General Trading (Nov 2018 - Apr 2019): Equipment maintenance
- Mechatronics Engineer at Flash Tech Company (Jun 2017 - Nov 2017): Solar energy systems and PLC programming

INTERESTS:
- Drawing, 3D Designing, Kung Fu, Robotics

CONTACT:
- Email: b_aljazzar@yahoo.com
- Phone: +971 56 611 3381
- LinkedIn: linkedin.com/in/bassam-aljazzar

MECHATRONICS ENGINEERING:
Mechatronics is a multidisciplinary field combining mechanical, electrical, and computer engineering to create efficient, reliable, and versatile systems. It includes robotics, automation, control systems, embedded systems, and IoT.

When answering:
- Be helpful, professional, and friendly
- Focus on Bassam's expertise in robotics and mechatronics
- Explain technical concepts clearly
- Highlight his projects and achievements
- If asked about topics outside Bassam's portfolio or mechatronics, politely redirect to relevant topics
- Keep responses concise but informative
- When users ask about the patent (براءة الاختراع, patent document, US11573635, face mask patent), use the show_patent_in_3d_lab function to highlight it in the virtual lab`;

  const thinkingDiv = document.createElement('div');
  thinkingDiv.className = 'output-line';
  thinkingDiv.innerHTML = `<span style="color:#888;font-style:italic;">🤖 AI is thinking...</span>`;
  terminalOutput.appendChild(thinkingDiv);
  terminalOutput.scrollTop = terminalOutput.scrollHeight;

  const recentHistory = chatHistory.slice(-8);
  const messages = [
    { role: 'system', content: systemPrompt },
    ...recentHistory,
    { role: 'user', content: userMessage }
  ];

  console.log(`📤 Sending ${messages.length} messages to API`);

  // 🔧 Tools definition
  const tools = [
    {
      type: "function",
      function: {
        name: "show_patent_in_3d_lab",
        description: "Highlights and activates the patent document view in the 3D virtual lab. Use this when user asks about the patent, wants to see the patent document, or asks about US Patent 11573635 or the face mask patent.",
        parameters: {
          type: "object",
          properties: {},
          required: []
        }
      }
    }
  ];

  async function tryAPI(attempt = 1) {
    console.log(`🔄 Attempt ${attempt}/2`);
    
    // POST attempt with Function Calling
    try {
      console.log('📮 Trying POST with Function Calling...');
      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 30000);
      
      const response = await fetch('https://text.pollinations.ai/openai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          messages: messages,
          model: 'openai',
          seed: 42,
          referrer: 'bassamaljazzar93.github.io',
          tools: tools,
          tool_choice: 'auto' // الـ AI يقرر متى يستخدم الـ function
        }),
        signal: controller.signal
      });
      
      clearTimeout(timeoutId);
      
      console.log(`📥 POST Response: ${response.status} ${response.statusText}`);
      
      if (response.ok) {
        const data = await response.json();
        const message = data?.choices?.[0]?.message;
        
        if (!message) {
          throw new Error('No message in response');
        }
        
        // 🎯 فحص إذا الـ AI استدعى function
        if (message.tool_calls && message.tool_calls.length > 0) {
          console.log('🔧 AI requested function call!');
          
          const toolCall = message.tool_calls[0];
          console.log(`📞 Calling: ${toolCall.function.name}`);
          
          if (toolCall.function.name === 'show_patent_in_3d_lab') {
            // 🎬 شغّل الـ function
            const result = triggerPatentView();
            console.log('✅ Function executed:', result);
            
            // 🔄 أرجع الـ result للـ AI عشان يكمل الرد
            messages.push(message); // رسالة الـ AI مع tool_call
            messages.push({
              role: 'tool',
              tool_call_id: toolCall.id,
              name: toolCall.function.name,
              content: JSON.stringify(result)
            });
            
            // 🔁 طلب ثاني للحصول على الرد النهائي
            const secondResponse = await fetch('https://text.pollinations.ai/openai', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                messages: messages,
                model: 'openai',
                seed: 42,
                referrer: 'bassamaljazzar93.github.io'
              })
            });
            
            if (secondResponse.ok) {
              const finalData = await secondResponse.json();
              const finalText = finalData?.choices?.[0]?.message?.content;
              if (finalText) {
                console.log('✅ POST Success with Function!');
                return finalText;
              }
            }
          }
        }
        
        // رد عادي بدون function call
        const text = message.content;
        if (text) {
          console.log('✅ POST Success!');
          return text;
        }
      }
      
      if (response.status === 429) {
        console.log('🚫 Rate limit hit (429)');
        throw new Error('RATE_LIMIT');
      }
      
      const errorText = await response.text().catch(() => 'no body');
      console.log('❌ POST failed:', errorText);
      
    } catch (e) {
      if (e.message === 'RATE_LIMIT') throw e;
      console.log('❌ POST error:', e.message);
    }

    // GET fallback (بدون function calling)
    try {
      console.log('📮 Trying GET fallback...');
      const lastAssistant = [...recentHistory]
        .reverse()
        .find(m => m.role === 'assistant')?.content || '';
      
      const prompt = [
        lastAssistant ? `Previous: ${lastAssistant.substring(0, 150)}` : '',
        `User: ${userMessage}`
      ].filter(Boolean).join('\n\n');

      const controller = new AbortController();
      const timeoutId = setTimeout(() => controller.abort(), 30000);
      
      const url = `https://text.pollinations.ai/${encodeURIComponent(prompt)}?model=openai&seed=42&referrer=bassamaljazzar93.github.io&system=${encodeURIComponent(systemPrompt)}`;
      
      const response = await fetch(url, { signal: controller.signal });
      clearTimeout(timeoutId);
      
      console.log(`📥 GET Response: ${response.status} ${response.statusText}`);
      
      if (response.ok) {
        const text = await response.text();
        if (text) {
          console.log('✅ GET Success!');
          
          // 🔍 Keyword detection كـ fallback
          const patentKeywords = ['patent', 'براءة', '11573635', 'mask', 'قناع'];
          if (patentKeywords.some(kw => text.toLowerCase().includes(kw) || userMessage.toLowerCase().includes(kw))) {
            console.log('🎯 Patent keyword detected in fallback');
            setTimeout(() => triggerPatentView(), 500);
          }
          
          return text;
        }
      }
      
      if (response.status === 429) {
        console.log('🚫 Rate limit hit (429)');
        throw new Error('RATE_LIMIT');
      }
      
    } catch (e) {
      if (e.message === 'RATE_LIMIT') throw e;
      console.log('❌ GET error:', e.message);
    }

    if (attempt < 2) {
      console.log('⏳ Waiting 6s before retry...');
      await new Promise(r => setTimeout(r, 6000));
      return tryAPI(attempt + 1);
    }
    
    throw new Error('ALL_FAILED');
  }

  try {
    const text = await tryAPI();
    thinkingDiv.remove();
    
    chatHistory.push(
      { role: 'user', content: userMessage },
      { role: 'assistant', content: text }
    );
    
    if (chatHistory.length > 16) {
      chatHistory = chatHistory.slice(-16);
    }
    
    logChatMessage(userMessage, text);
    console.log('✅ Chat completed successfully');
    return `<span style="color:#5BCEFA;">🤖 AI:</span> ${text}`;
    
  } catch (error) {
    thinkingDiv.remove();
    console.error('💥 Final error:', error.message);
    
    if (error.message === 'RATE_LIMIT') {
      return `<span style="color:#ffa500;">⚠️ تم تجاوز الحد المسموح. انتظر 6 ثواني</span>`;
    }
    
    return `<span style="color:#ff6b6b;">❌ فشل الاتصال. جرّب مرة ثانية</span>`;
  } finally {
    window.__aiBusy = false;
  }
}
        function getDirectory(path) {
            if (path === '~') return fileSystem['~'];
            
            const parts = path.replace('~/', '').replace('~', '').split('/').filter(p => p);
            let current = fileSystem['~'];
            
            for (const part of parts) {
                if (!current.contents || !current.contents[part]) {
                    return null;
                }
                current = current.contents[part];
            }
            
            return current;
        }

        function getFile(filename) {
            const dir = getDirectory(currentDir);
            if (!dir || !dir.contents) return null;
            return dir.contents[filename];
        }

        function addOutput(content, isCommand = false, commandText = '') {
            const div = document.createElement('div');
            div.className = 'output-line';
            
            if (isCommand) {
                if (chatMode) {
                    div.innerHTML = `<span style="color: #5BCEFA;">👤 You:</span> <span class="command">${commandText}</span>`;
                } else {
                    div.innerHTML = `<span class="username">bassam@portfolio</span><span class="separator">:</span><span class="directory">${currentDir}</span><span class="separator">$ </span><span class="command">${commandText}</span>`;
                }
            } else {
                div.innerHTML = content;
            }
            
            terminalOutput.appendChild(div);
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        function executeCommand(input) {
            const trimmed = input.trim();
            if (!trimmed) return;

            commandHistory.push(trimmed);
            historyIndex = -1;

            // Check if in chat mode
            if (chatMode) {
                if (trimmed.toLowerCase() === 'exit') {
                    chatMode = false;
                    chatHistory = [];
                    currentDir = '~';
                    currentDirElement.textContent = '~';
                    addOutput('', true, trimmed);
                    addOutput('<span style="color: #00ff00;">✓ Exited chat mode. Back to terminal.</span>');
                    return;
                }

                // Send message to AI
                addOutput('', true, trimmed);
                sendChatMessage(trimmed).then(response => {
                    addOutput(response);
                });
                return;
            }

            addOutput('', true, trimmed);

            const [cmd, ...args] = trimmed.split(' ');
            const command = commands[cmd];

            const output = command ? command(args) : `bash: ${cmd}: command not found\nType 'help' for available commands.`;

            if (output !== null) {
                addOutput(output);
            }
        }

        // Nav click handler
        function executeNavCommand(cmd) {
            commandInput.value = cmd;
            executeCommand(cmd);
            commandInput.value = '';
            // Don't auto-focus on mobile after nav command
            if (window.innerWidth > 768) {
                commandInput.focus();
            }
        }

        // Event listeners
        commandInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                executeCommand(commandInput.value);
                commandInput.value = '';
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (commandHistory.length > 0) {
                    historyIndex = historyIndex === -1 ? commandHistory.length - 1 : Math.max(0, historyIndex - 1);
                    commandInput.value = commandHistory[historyIndex];
                }
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (historyIndex !== -1) {
                    historyIndex++;
                    if (historyIndex >= commandHistory.length) {
                        historyIndex = -1;
                        commandInput.value = '';
                    } else {
                        commandInput.value = commandHistory[historyIndex];
                    }
                }
            } else if (e.key === 'Tab') {
                e.preventDefault();
                const matches = Object.keys(commands).filter(cmd => cmd.startsWith(commandInput.value.toLowerCase()));
                if (matches.length === 1) {
                    commandInput.value = matches[0];
                }
            } else if (e.key === 'l' && e.ctrlKey) {
                e.preventDefault();
                commands.clear();
            }
        });

        // Focus input only when clicking on terminal or input itself
        terminalOutput.addEventListener('click', (e) => {
            commandInput.focus();
        });

        commandInput.addEventListener('click', () => {
            commandInput.focus();
        });

        // Prevent 3D viewer from focusing input
        const viewerSection = document.querySelector('.viewer-section');
        if (viewerSection) {
            viewerSection.addEventListener('touchstart', (e) => {
                // Don't focus input when touching 3D viewer
                e.stopPropagation();
            });
            
            viewerSection.addEventListener('click', (e) => {
                // Don't focus input when clicking 3D viewer
                e.stopPropagation();
            });
        }

        // Welcome message
        window.addEventListener('load', async () => {
            // Fix viewport height for mobile browsers (especially iOS)
            const setViewportHeight = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            
            setViewportHeight();
            window.addEventListener('resize', setViewportHeight);
            window.addEventListener('orientationchange', setViewportHeight);
            
            // Get country and log visitor
            await getCountry();
            logVisitor();
            
            addOutput(`<pre style="color: #00ff00; line-height: 1.2; font-size: 0.75em;">
 ██████╗  █████╗ ███████╗███████╗ █████╗ ███╗   ███╗     █████╗ ██╗         ██╗ █████╗ ███████╗███████╗ █████╗ ██████╗ 
 ██╔══██╗██╔══██╗██╔════╝██╔════╝██╔══██╗████╗ ████║    ██╔══██╗██║         ██║██╔══██╗╚══███╔╝╚══███╔╝██╔══██╗██╔══██╗
 ██████╔╝███████║███████╗███████╗███████║██╔████╔██║    ███████║██║         ██║███████║  ███╔╝   ███╔╝ ███████║██████╔╝
 ██╔══██╗██╔══██║╚════██║╚════██║██╔══██║██║╚██╔╝██║    ██╔══██║██║    ██   ██║██╔══██║ ███╔╝   ███╔╝  ██╔══██║██╔══██╗
 ██████╔╝██║  ██║███████║███████║██║  ██║██║ ╚═╝ ██║    ██║  ██║███████╗╚█████╔╝██║  ██║███████╗███████╗██║  ██║██║  ██║
 ╚═════╝ ╚═╝  ╚═╝╚══════╝╚══════╝╚═╝  ╚═╝╚═╝     ╚═╝    ╚═╝  ╚═╝╚══════╝ ╚════╝ ╚═╝  ╚═╝╚══════╝╚══════╝╚═╝  ╚═╝╚═╝  ╚═╝
</pre>`);
            addOutput(`<span style="color: #5BCEFA; font-weight: bold;">Welcome to Bassam Aljazzar's Interactive Portfolio Terminal</span>

<span style="color: #F5A9B8;">Mechatronics Engineer | Robotics Specialist | Innovation Consultant</span>
<span style="color: #00ff00;">📍 Abu Dhabi, UAE | 8 Years Experience | Patent Holder (US11573635)</span>

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`);
            
            // Don't auto-focus on mobile to prevent keyboard popup
            if (window.innerWidth > 768) {
                commandInput.focus();
            }
        });
    </script>
</body>
</html>;
        }

        function updatePreview() {
            const preview = document.getElementById('previewFrame');
            const code = editor.getValue();
            preview.srcdoc = code;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            const apiKey = document.getElementById('apiKey').value.trim();

            if (!message) return;

            if (!apiKey) {
                alert(currentLanguage === 'en' ? 
                    'Please enter your Groq API key first!' : 
                    'الرجاء إدخال مفتاح Groq API أولاً!');
                return;
            }

            // Add user message
            addChatMessage('user', message);
            input.value = '';

            // Disable send button
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<span class="loading"></span>';

            try {
                const currentCode = editor.getValue();
                const response = await callGroqAPI(apiKey, message, currentCode);
                
                // Add AI response
                addChatMessage('ai', response.message);

                // Apply code changes if any
                if (response.code) {
                    editor.setValue(response.code);
                    updatePreview();
                }
            } catch (error) {
                addChatMessage('ai', `Error: ${error.message}`);
                console.error('Groq API Error:', error);
            } finally {
                sendBtn.disabled = false;
                sendBtn.textContent = currentLanguage === 'en' ? 'Send' : 'إرسال';
            }
        }

        async function callGroqAPI(apiKey, userMessage, currentCode) {
            const systemPrompt = `You are an expert web developer assistant. Help users customize their portfolio HTML code.
When the user asks for changes:
1. Analyze the current code
2. Make the requested modifications
3. Return the complete modified HTML code
4. Explain what you changed

Always return your response in this JSON format:
{
    "message": "Explanation of changes made",
    "code": "Complete modified HTML code (or null if just answering questions)"
}

Current code:
${currentCode}`;

            const response = await fetch(GROQ_API_URL, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'llama-3.3-70b-versatile',
                    messages: [
                        { role: 'system', content: systemPrompt },
                        { role: 'user', content: userMessage }
                    ],
                    temperature: 0.7,
                    max_tokens: 4000
                })
            });

            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'API request failed');
            }

            const data = await response.json();
            const aiResponse = data.choices[0].message.content;

            // Try to parse JSON response
            try {
                return JSON.parse(aiResponse);
            } catch {
                // If not JSON, treat as plain message
                return { message: aiResponse, code: null };
            }
        }

        function addChatMessage(type, content) {
            const container = document.getElementById('chatContainer');
            const message = document.createElement('div');
            message.className = `chat-message ${type}`;
            
            const label = document.createElement('div');
            label.className = 'label';
            label.textContent = type === 'user' ? 
                (currentLanguage === 'en' ? 'You' : 'أنت') : 
                (currentLanguage === 'en' ? 'AI Assistant' : 'المساعد الذكي');
            
            const text = document.createElement('div');
            text.textContent = content;
            
            message.appendChild(label);
            message.appendChild(text);
            container.appendChild(message);
            
            container.scrollTop = container.scrollHeight;
        }

        function quickAction(action) {
            const actions = {
                color: currentLanguage === 'en' ? 
                    'Change the color scheme to a modern blue and orange gradient' :
                    'غير نظام الألوان إلى تدرج أزرق وبرتقالي عصري',
                font: currentLanguage === 'en' ?
                    'Change the font to a more modern sans-serif font' :
                    'غير الخط إلى خط sans-serif عصري',
                section: currentLanguage === 'en' ?
                    'Add a new "Experience" section with a timeline layout' :
                    'أضف قسم "الخبرات" جديد بتصميم خط زمني',
                animation: currentLanguage === 'en' ?
                    'Add smooth animations to all sections on scroll' :
                    'أضف حركات سلسة لجميع الأقسام عند التمرير'
            };

            document.getElementById('userInput').value = actions[action];
            sendMessage();
        }

        function copyCode() {
            const code = editor.getValue();
            navigator.clipboard.writeText(code).then(() => {
                alert(currentLanguage === 'en' ? 'Code copied to clipboard!' : 'تم نسخ الكود!');
            });
        }

        function downloadCode() {
            const code = editor.getValue();
            const blob = new Blob([code], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'portfolio.html';
            a.click();
            URL.revokeObjectURL(url);
        }

        function resetCode() {
            if (confirm(currentLanguage === 'en' ? 
                'Reset to default template?' : 
                'إعادة تعيين إلى القالب الافتراضي؟')) {
                editor.setValue(getPortfolioTemplate());
                updatePreview();
            }
        }

        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
            document.documentElement.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
            
            // Update all translatable elements
            document.querySelectorAll('[data-en]').forEach(el => {
                el.textContent = el.getAttribute(`data-${currentLanguage}`);
            });

            document.querySelectorAll('[data-en-placeholder]').forEach(el => {
                el.placeholder = el.getAttribute(`data-${currentLanguage}-placeholder`);
            });

            // Update language button
            document.querySelector('.lang-switch').textContent = 
                currentLanguage === 'en' ? 'العربية' : 'English';
        }
    </script>
</body>
</html>

